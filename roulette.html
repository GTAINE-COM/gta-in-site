<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–†—É–ª–µ—Ç–∫–∞ ‚Äî GTAINE</title>
  <link rel="stylesheet" href="assets/style.css" />
  <link rel="icon" type="image/svg+xml" href="assets/gtaine-logo.svg">

  <style>
    .r-wrap{padding:28px 0 70px}
    .card{
      background:rgba(10,12,18,.55);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      backdrop-filter: blur(10px);
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .r-head{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;padding:16px}
    .r-title{margin:0;font-size:34px;font-weight:900}
    .r-sub{opacity:.75;margin-top:6px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);font-weight:900}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
      padding:12px 14px;border-radius:14px;border:0;cursor:pointer;font-weight:900;
      color:#0b0f14;
      background:linear-gradient(90deg, #ff6a2b, #ffb23a);
      box-shadow:0 16px 28px rgba(255,122,40,.18);
      white-space:nowrap;
    }
    .btn.secondary{
      background:rgba(255,255,255,.08);
      color:#fff;border:1px solid rgba(255,255,255,.12);
      box-shadow:none;
    }
    .btn:disabled{opacity:.45;cursor:not-allowed}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;margin-top:14px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}

    /* Reel */
    .reelWrap{padding:16px}
    .reelTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .reelBox{
      position:relative;
      overflow:hidden;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      height:190px;
    }
    .pointer{
      position:absolute;
      left:50%;
      top:10px;
      transform:translateX(-50%);
      width:0;height:0;
      border-left:12px solid transparent;
      border-right:12px solid transparent;
      border-top:18px solid rgba(255,140,60,.95);
      filter:drop-shadow(0 10px 14px rgba(0,0,0,.35));
      z-index:5;
    }
    .reel{
      position:absolute;
      left:0;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      gap:12px;
      padding:0 18px;
      will-change: transform;
    }
    .item{
      width:170px;
      height:130px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      gap:8px;
      user-select:none;
    }
    .icon{font-size:34px}
    .iname{font-weight:900}
    .irare{opacity:.7;font-size:12px}
    .centerGlow{
      position:absolute;
      left:50%;
      top:0;
      transform:translateX(-50%);
      width:220px;
      height:100%;
      background:linear-gradient(180deg, rgba(255,140,60,.14), rgba(0,0,0,0));
      border-left:1px solid rgba(255,255,255,.08);
      border-right:1px solid rgba(255,255,255,.08);
      pointer-events:none;
      z-index:2;
    }

    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .field{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
    }
    .field input{width:84px;background:transparent;border:0;color:#fff;outline:none;font-weight:900}
    .toggle{display:flex;align-items:center;gap:10px;margin-left:auto}
    .msg{margin-top:10px;opacity:.9}
    .msg.good{color:#7affb2}
    .msg.bad{color:#ff7a7a}

    .side{padding:16px}
    .list{display:grid;gap:10px;margin-top:10px}
    .logRow{
      padding:12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03);
      display:flex;justify-content:space-between;gap:10px;align-items:center;
      font-weight:800;
    }
    .small{opacity:.7;font-size:12px}
  </style>
</head>

<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <div class="container topbar__inner">
      <a class="brand" href="./">
        <img class="brand__badge" src="assets/logo.png" alt="GTAINE">
        <span class="brand__name">
          <span class="brand__title">GTAINE</span>
          <span class="brand__sub">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π RP-–ø—Ä–æ–µ–∫—Ç</span>
        </span>
      </a>

      <div class="navwrap">
        <nav class="nav">
          <a class="nav__link" href="./">–ì–æ–ª–æ–≤–Ω–∞</a>
          <a class="nav__link" href="./forum.html">–§–æ—Ä—É–º</a>
          <a class="nav__link" href="./wiki/">–í—ñ–∫—ñ</a>
          <a class="nav__link is-active" href="./roulette.html">–†—É–ª–µ—Ç–∫–∞</a>
          <a class="nav__link" href="./giveaway.html">–†–æ–∑—ñ–≥—Ä–∞—à</a>
          <a class="nav__link" href="./download.html">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</a>
        </nav>
        <a class="chip" href="./cabinet.html">–ö–∞–±—ñ–Ω–µ—Ç</a>
      </div>
    </div>
  </header>

  <main class="r-wrap">
    <div class="container">
      <section class="card">
        <div class="r-head">
          <div>
            <h1 class="r-title">–Ü–≥—Ä–æ–≤–∞ —Ä—É–ª–µ—Ç–∫–∞</h1>
            <div class="r-sub">–ë–∞–ª–∞–Ω—Å —ñ —ñ—Å—Ç–æ—Ä—ñ—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –∫–∞–±—ñ–Ω–µ—Ç—ñ (–¥–µ–º–æ –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞).</div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
            <span class="pill">ü™ô Coins: <b id="coins">0</b></span>
            <span class="pill">üéÅ Free: <b id="freeSpins">0</b></span>
            <a class="btn secondary" href="./cabinet.html">–î–æ –∫–∞–±—ñ–Ω–µ—Ç—É</a>
          </div>
        </div>
      </section>

      <div class="grid">
        <!-- Reel -->
        <section class="card reelWrap">
          <div class="reelTop">
            <div class="pill">üéØ –ü–æ–ø–∞–¥–∏ –ø—ñ–¥ —Å—Ç—Ä—ñ–ª–∫—É</div>
            <div class="pill">–°—Ç–∞–≤–∫–∞: <b id="costView">89</b> coins</div>
          </div>

          <div class="reelBox">
            <div class="pointer"></div>
            <div class="centerGlow"></div>
            <div class="reel" id="reel"></div>
          </div>

          <div class="controls">
            <div class="field">
              <span class="small">–¶—ñ–Ω–∞</span>
              <input id="cost" type="number" min="1" value="89">
              <span class="small">coins</span>
            </div>

            <button class="btn secondary" id="btnFree">–ö—Ä—É—Ç–∏—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ</button>
            <button class="btn" id="btnSpin">–ö–†–£–¢–ò–¢–ò –ó–ê ü™ô</button>

            <label class="toggle">
              <span class="small">–®–≤–∏–¥–∫–æ</span>
              <input id="fast" type="checkbox">
            </label>
          </div>

          <div id="msg" class="msg"></div>
          <div class="small" style="margin-top:10px;opacity:.65">
            ‚ö†Ô∏è –¶–µ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∞ –≤–µ—Ä—Å—ñ—è. –î–ª—è ‚Äú—Å–µ—Ä–≤–µ—Ä–Ω–æ—ó‚Äù —Ä—É–ª–µ—Ç–∫–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω API (—â–æ–± –Ω–µ –Ω–∞–∫—Ä—É—á—É–≤–∞–ª–∏ coins).
          </div>
        </section>

        <!-- Side -->
        <aside class="card side">
          <div style="font-weight:900;font-size:16px">–°–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –≤–∏–≥—Ä–∞—à—ñ–≤</div>
          <div class="small" style="margin-top:6px">–û—Å—Ç–∞–Ω–Ω—ñ 15 —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</div>

          <div class="list" id="log"></div>

          <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn secondary" id="btnClear">–û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é</button>
            <button class="btn secondary" id="btnAddFree">+1 Free (—Ç–µ—Å—Ç)</button>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <script>
    // ======= Shared storage with cabinet.html =======
    const STORAGE_KEY = "gtaine_user_v1";
    const LOG_KEY = "gtaine_roulette_log_v1";

    const $ = (s)=>document.querySelector(s);

    // Prize pool (–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã + –∫–∞—Ä—Ç–∏–Ω–∫–∏)
    const PRIZES = [
      { id:"money250", icon:"üíµ", name:"–ì—Ä–æ—à—ñ ‚Ç¥250,000", rare:"–∑–≤–∏—á–∞–π–Ω–∏–π", reward:{ type:"cash", amount:250000 }, weight:35 },
      { id:"money2500", icon:"üí∞", name:"–ì—Ä–æ—à—ñ ‚Ç¥2,250,000", rare:"—Ä—ñ–¥–∫—ñ—Å–Ω–∏–π", reward:{ type:"cash", amount:2250000 }, weight:10 },
      { id:"canister", icon:"‚õΩ", name:"–ö–∞–Ω—ñ—Å—Ç—Ä–∞", rare:"–∑–≤–∏—á–∞–π–Ω–∏–π", reward:{ type:"item", amount:1 }, weight:18 },
      { id:"battery", icon:"üîã", name:"–ê–∫—É–º—É–ª—è—Ç–æ—Ä", rare:"–∑–≤–∏—á–∞–π–Ω–∏–π", reward:{ type:"item", amount:1 }, weight:18 },
      { id:"paint", icon:"ü™£", name:"–°–∏–Ω—è —Ñ–∞—Ä–±–∞", rare:"—Ä—ñ–¥–∫—ñ—Å–Ω–∏–π", reward:{ type:"item", amount:1 }, weight:10 },
      { id:"skin1", icon:"üß•", name:"–°–∫—ñ–Ω: –í—ñ–¥–≤–∞–∂–Ω–∞ –ª–∏—Ö–æ–¥—ñ–π–∫–∞", rare:"–µ–ø—ñ—á–Ω–∏–π", reward:{ type:"item", amount:1 }, weight:5 },
      { id:"skin2", icon:"üß¢", name:"–°–∫—ñ–Ω: –î—ñ–≤—á–∏–Ω–∞ –¥–∞–π–≤–µ—Ä", rare:"–µ–ø—ñ—á–Ω–∏–π", reward:{ type:"item", amount:1 }, weight:3 },
      { id:"skin3", icon:"üòà", name:"–°–∫—ñ–Ω: –°—Ç–∏–ª—å–Ω–∏–π –º–∞—á–æ", rare:"–ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π", reward:{ type:"item", amount:1 }, weight:1 },
    ];

    // Build reel items (–¥–ª–∏–Ω–Ω–∞—è –ª–µ–Ω—Ç–∞)
    const reel = $("#reel");
    const ITEMS_REPEAT = 60; // —á–µ–º –±–æ–ª—å—à–µ, —Ç–µ–º –¥–ª–∏–Ω–Ω–µ–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
    const reelItems = [];
    for(let i=0;i<ITEMS_REPEAT;i++){
      const p = PRIZES[i % PRIZES.length];
      reelItems.push(p);
    }
    reel.innerHTML = reelItems.map(p=>`
      <div class="item">
        <div class="icon">${p.icon}</div>
        <div class="iname">${p.name}</div>
        <div class="irare">${p.rare}</div>
      </div>
    `).join("");

    function loadUser(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "null"); }
      catch { return null; }
    }
    function saveUser(u){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(u));
    }

    function loadLog(){
      try { return JSON.parse(localStorage.getItem(LOG_KEY) || "[]"); }
      catch { return []; }
    }
    function saveLog(arr){
      localStorage.setItem(LOG_KEY, JSON.stringify(arr));
    }

    function weightedPick(){
      const total = PRIZES.reduce((s,p)=>s+p.weight,0);
      let r = Math.random()*total;
      for(const p of PRIZES){
        r -= p.weight;
        if(r<=0) return p;
      }
      return PRIZES[0];
    }

    function renderBalances(){
      const u = loadUser();
      const coins = u?.profile?.coins ?? 0;
      const free = u?.profile?.freeSpins ?? 0;
      $("#coins").textContent = coins.toLocaleString("uk-UA");
      $("#freeSpins").textContent = free.toLocaleString("uk-UA");
    }

    function renderLog(){
      const log = loadLog().slice(0,10);
      const box = $("#log");
      box.innerHTML = log.length ? log.map(x=>`
        <div class="logRow">
          <span>${x.icon} ${x.name}</span>
          <span class="small">${x.when}</span>
        </div>
      `).join("") : `<div class="small" style="opacity:.7;margin-top:10px">–ü–æ–∫–∏ —â–æ –ø–æ—Ä–æ–∂–Ω—å–æ</div>`;
    }

    // --- Spin logic ---
    let spinning = false;

    function setMsg(text, good){
      const m = $("#msg");
      m.textContent = text;
      m.className = "msg " + (good ? "good" : "bad");
    }

    function nowStr(){
      const d = new Date();
      return d.toLocaleString("uk-UA");
    }

    function applyReward(prize){
      const u = loadUser();
      if(!u){ return; }

      // cash reward -> –¥–æ–±–∞–≤–∏–º –≤ "cash"
      if(prize.reward.type === "cash"){
        u.profile.cash = (u.profile.cash || 0) + prize.reward.amount;
      }
      // item reward -> –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –≤ –∏—Å—Ç–æ—Ä–∏—é (–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º —Å–¥–µ–ª–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å)
      saveUser(u);
    }

    function spendCoins(cost){
      const u = loadUser();
      if(!u) return {ok:false, reason:"–ù–µ–º–∞—î —Å–µ—Å—ñ—ó. –ó–∞–π–¥–∏ –≤ –∫–∞–±—ñ–Ω–µ—Ç —ñ –Ω–∞—Ç–∏—Å–Ω–∏ –î–µ–º–æ-–≤—Ö—ñ–¥."};

      u.profile.coins = u.profile.coins ?? 0;
      u.profile.freeSpins = u.profile.freeSpins ?? 0;

      // free spin
      if(u.profile.freeSpins > 0){
        u.profile.freeSpins -= 1;
        saveUser(u);
        return {ok:true, free:true};
      }

      // paid
      if(u.profile.coins < cost) return {ok:false, reason:"–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ coins."};
      u.profile.coins -= cost;
      saveUser(u);
      return {ok:true, free:false};
    }

    function addLog(prize){
      const arr = loadLog();
      arr.unshift({ icon: prize.icon, name: prize.name, when: nowStr() });
      saveLog(arr.slice(0,50));
      renderLog();
    }

    async function spin(useFreeButton){
      if(spinning) return;
      const u = loadUser();
      if(!u){
        setMsg("–°–ø–æ—á–∞—Ç–∫—É –∑–∞–π–¥–∏ –≤ –∫–∞–±—ñ–Ω–µ—Ç (cabinet.html) —ñ –∑—Ä–æ–±–∏ –î–µ–º–æ-–≤—Ö—ñ–¥.", false);
        return;
      }

      const cost = Math.max(1, parseInt($("#cost").value || "89", 10));
      $("#costView").textContent = String(cost);

      // –µ—Å–ª–∏ –∂–º—É—Ç free ‚Äî –ø—ã—Ç–∞–µ–º—Å—è —Å–ø–∏—Å–∞—Ç—å free (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–∫–∞–∂–µ–º)
      if(useFreeButton){
        if((u.profile.freeSpins ?? 0) <= 0){
          setMsg("–ù–µ–º–∞—î –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö —Å–ø—ñ–Ω—ñ–≤. –ö—Ä—É—Ç–∏ –∑–∞ coins.", false);
          return;
        }
      }

      const pay = spendCoins(cost);
      if(!pay.ok){
        setMsg(pay.reason, false);
        renderBalances();
        return;
      }

      renderBalances();

      // choose prize
      const prize = weightedPick();

      // animation: –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–æ –Ω—É–∂–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
      spinning = true;
      $("#btnSpin").disabled = true;
      $("#btnFree").disabled = true;

      const fast = $("#fast").checked;
      const duration = fast ? 1200 : 3200;

      // –ù–∞–π–¥–µ–º –∏–Ω–¥–µ–∫—Å –±–ª–∏–∂–∞–π—à–µ–≥–æ –≤ –ª–µ–Ω—Ç–µ —Å —Ç–∞–∫–∏–º –ø—Ä–∏–∑–æ–º –±–ª–∏–∂–µ –∫ –∫–æ–Ω—Ü—É
      const allEls = Array.from(reel.children);
      let targetIndex = allEls.length - 10;
      for(let i = allEls.length - 1; i >= 0; i--){
        const p = reelItems[i];
        if(p.id === prize.id){ targetIndex = i; break; }
      }

      // —à–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ 170 + gap 12 = 182
      const step = 182;
      const centerOffset = (window.innerWidth * 0.5) - 90; // –ø—Ä–∏–º–µ—Ä–Ω–æ —Ü–µ–Ω—Ç—Ä
      const toX = -(targetIndex * step) + centerOffset;

      reel.style.transition = `transform ${duration}ms cubic-bezier(.1,.9,.1,1)`;
      reel.style.transform = `translate(${toX}px, -50%)`;

      setMsg(pay.free ? "üéÅ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π —Å–ø—ñ–Ω..." : "üé∞ –ö—Ä—É—Ç–∏–º–æ...", true);

      await new Promise(r => setTimeout(r, duration + 120));

      // apply reward + log
      applyReward(prize);
      addLog(prize);

      setMsg(`‚úÖ –í–∏–ø–∞–ª–æ: ${prize.icon} ${prize.name}`, true);

      // enable again
      spinning = false;
      $("#btnSpin").disabled = false;
      $("#btnFree").disabled = false;

      // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å (cash –º–µ–Ω—è–µ—Ç—Å—è –≤ –∫–∞–±–∏–Ω–µ—Ç–µ, coins/free —É–∂–µ —Ç—É—Ç)
      renderBalances();
    }

    // Buttons
    $("#btnSpin").addEventListener("click", ()=>spin(false));
    $("#btnFree").addEventListener("click", ()=>spin(true));

    $("#cost").addEventListener("input", ()=>{
      const v = Math.max(1, parseInt($("#cost").value || "1", 10));
      $("#costView").textContent = String(v);
    });

    $("#btnClear").addEventListener("click", ()=>{
      saveLog([]);
      renderLog();
      setMsg("–Ü—Å—Ç–æ—Ä—ñ—é –æ—á–∏—â–µ–Ω–æ.", true);
    });

    $("#btnAddFree").addEventListener("click", ()=>{
      const u = loadUser();
      if(!u){ setMsg("–ó–∞–π–¥–∏ –≤ –∫–∞–±—ñ–Ω–µ—Ç —ñ —É–≤—ñ–π–¥–∏.", false); return; }
      u.profile.freeSpins = (u.profile.freeSpins ?? 0) + 1;
      saveUser(u);
      renderBalances();
      setMsg("‚úÖ –î–æ–¥–∞–Ω–æ +1 Free (—Ç–µ—Å—Ç).", true);
    });

    // Init
    renderBalances();
    renderLog();
    // –µ—Å–ª–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ –µ—â–µ –Ω–µ—Ç –ø–æ–ª—è freeSpins ‚Äî –¥–æ–±–∞–≤–∏–º 0
    (function normalize(){
      const u = loadUser();
      if(!u) return;
      u.profile.freeSpins = u.profile.freeSpins ?? 0;
      saveUser(u);
      renderBalances();
    })();
  </script>
</body>
</html>
